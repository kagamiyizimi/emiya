function changeVerify(t, e) {
    Array.from(t).each(function (t) {
        var i, n;
        "IMG" === t.tagName ? (n = t, i = t.getAttribute("src").split("?")[0]) : "A" === t.tagName && (n = t.getPrevious("img"), i = t.getAttribute("href")), e ? t.addEvent("click", changeCode.bind(t, n, i)) : changeCode(n, i)
    })
}
function changeCode(t, e) {
    return e = e || t.src.split("?")[0], t.src = e + "?" + +new Date, !1
}
function checkAll(t, e) {
    e.set("checked", t.checked)
}
function Message(t, e, i, n, s) {
    if (!t)return null;
    isNaN(e) ? "function" === typeOf(i) ? (n = i, i = 3) : (e = e || "show", i = isNaN(i) ? 3 : i) : (i = e, e = "show");
    var o = {container: "message-" + e, body: "message-body", content: "message-content", icon: {show: "", success: "&#x25;", error: "&#x21;"}[e]}, a = document.id("pop_message_" + e);
    return a && (a = a.retrieve("instance")) && (a.content.innerHTML = t, a.show()), new Popup(new Element("div[html=" + t + "]"), {
        id: "pop_message_" + e,
        type: "nohead",
        template: s || document.id("message_template"),
        modal: !1,
        pins: !0,
        single: !0,
        effect: !0,
        autoHide: i,
        component: o,
        onShow: function () {
            this.stopTimer()
        },
        onClose: "function" === typeOf(n) ? n.bind(this) : null
    }), "error" == e ? !1 : !0
}
function maxZindex(t, e) {
    t = $$(t || "div");
    var i = 0;
    if (t.length) {
        var n = t.filter(function (t) {
            return 1 != t.nodeType || ["script", "link", "base", "style"].contains(t.tagName.toLowerCase()) ? void 0 : ["absolute", "relative", "fixed"].contains(t.getStyle("position"))
        });
        if (n.length)for (var s = 0, o = n.length; o > s; s++)var a = n[s].getStyle("z-index"), i = Math.max(i, isNaN(a) ? 0 : a)
    }
    return e && (i += parseInt(e)), Math.min(i, 2147483647)
}
var validatorMap = {
    required: [LANG_formplus.validate.required, function (t, e, i) {
        return "select-one" == i || "select" == i ? (i = t.selectedIndex, e = t.options[i].value, i >= 0 && "" != e && "_NULL_" != e) : null !== e && 0 !== e.length
    }], minLength: [function (t, e, i) {
        return "null" != typeOf(i) ? LANG_formplus.validate.minLength.substitute({minLength: i, length: e.length}) : ""
    }, function (t, e, i, n, s) {
        return "null" != typeOf(s) ? e.length >= (s || 0) : !0
    }], maxLength: [function (t, e, i) {
        return "null" != typeOf(i) ? LANG_formplus.validate.maxLength.substitute({maxLength: i, length: e.length}) : ""
    }, function (t, e, i, n, s) {
        return "null" != typeOf(s) ? e.length <= (s || 1e4) : !0
    }], number: [LANG_formplus.validate.number, function (t, e) {
        return !isNaN(e) && !/^\s+$/.test(e)
    }], msn: [LANG_formplus.validate.msn, function (t, e) {
        return null === e || "" == e || /\S+@\S+/.test(e)
    }], skype: [LANG_formplus.validate.skype, function (t, e) {
        return !/\W/.test(e) || /^[a-zA-Z0-9]+$/.test(e)
    }], digits: [LANG_formplus.validate.digits, function (t, e) {
        return !/[^\d]/.test(e)
    }], unsignedint: [LANG_formplus.validate.unsignedint, function (t, e) {
        return !/[^\d]/.test(e) && e > 0
    }], unsigned: [LANG_formplus.validate.unsigned, function (t, e) {
        return !isNaN(e) && !/^\s+$/.test(e) && e >= 0
    }], positive: [LANG_formplus.validate.positive, function (t, e) {
        return !isNaN(e) && !/^\s+$/.test(e) && e > 0
    }], alpha: [LANG_formplus.validate.alpha, function (t, e) {
        return null === e || "" == e || /^[a-zA-Z]+$/.test(e)
    }], alphaint: [LANG_formplus.validate.alphaint, function (t, e) {
        return !/\W/.test(e) || /^[a-zA-Z0-9]+$/.test(e)
    }], alphanum: [LANG_formplus.validate.alphanum, function (t, e) {
        return !/\W/.test(e) || /^[\u4e00-\u9fa5a-zA-Z0-9]+$/.test(e)
    }], unzhstr: [LANG_formplus.validate.unzhstr, function (t, e) {
        return !/\W/.test(e) || !/^[\u4e00-\u9fa5]+$/.test(e)
    }], date: [LANG_formplus.validate.date, function (t, e) {
        return null === e || "" == e || /^(19|20)[0-9]{2}-([1-9]|0[1-9]|1[012])-([1-9]|0[1-9]|[12][0-9]|3[01])$/.test(e)
    }], email: [LANG_formplus.validate.email, function (t, e) {
        return null === e || "" == e || /^[a-z\d][a-z\d_.]*@[\w-]+(?:\.[a-z]{2,})+$/i.test(e)
    }], emaillist: [LANG_formplus.validate.email, function (t, e) {
        return null === e || "" == e || /^(?:[a-z\d][a-z\d_.]*@[\w-]+(?:\.[a-z]{2,})+[,;\s]?)+$/i.test(e)
    }], mobile: [LANG_formplus.validate.mobile, function (t, e) {
        return null === e || "" == e || /^0?1[34578]\d{9}$/.test(e)
    }], tel: [LANG_formplus.validate.tel, function (t, e) {
        return null === e || "" == e || /^(0\d{2,3}-?)?[2-9]\d{5,7}(-\d{1,5})?$/.test(e)
    }], phone: [LANG_formplus.validate.phone, function (t, e) {
        return null === e || "" == e || /^0?1[3458]\d{9}$|^(0\d{2,3}-?)?[2-9]\d{5,7}(-\d{1,5})?$/.test(e)
    }], zip: [LANG_formplus.validate.zip, function (t, e) {
        return null === e || "" == e || /^\d{6}$/.test(e)
    }], url: [LANG_formplus.validate.url, function (t, e) {
        var i = RegExp("^((https|http|ftp|rtsp|mms)?://)?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,4})?((/?)|(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$", "i");
        return null === e || "" == e || i.test(e)
    }], area: [LANG_formplus.validate.area, function (t, e) {
        return t.getElements("select").every(function (t) {
            var e = t.get("value");
            return t.isDisplayed() ? "" != e && "_NULL_" != e : !0
        })
    }], equal: [LANG_formplus.validate.equal, function (t, e, i, n, s) {
        return t = n.getElement('[name="' + s + '"]'), !t || e === t.value
    }], onerequired: [LANG_formplus.validate.onerequired, function (t, e, i, n) {
        return t = t.name, n.getElements("input" + (t ? '[name="' + t + '"]' : "")).some(function (t) {
            return ["checkbox", "radio"].contains(t.type) ? t.checked : !!t.value
        })
    }]
}, validate = function (t, e, i) {
    if (t = t || 0 === t ? document.id(t) : null, e = e || "", !t)return !0;
    var n = t.match("form") || "all" == e ? t.getElements("[vtype], [pattern]") : Array.from(t), s = [];
    return n.each(function (e, n) {
        if (!e.isVisible() || !e.get("vtype"))return !0;
        var o = e.get("vtype").split("&&"), a = e.get("pattern"), r = new RegExp(a), h = e.get("data-caution") || "", l = "custom_" + e.get("uid");
        if (a && (validatorMap[l] || (validatorMap[l] = [e.get("data-attention") || "", function (t, e) {
                return null === e || "" === e || r.test(e)
            }]), o = o.clean().include(l)), e.get("required") && (o = ["required"].combine(o), e.erase("required")), !o.length)return !0;
        var c = o.every(function (n, s) {
            var o = "", a = n.split(":");
            if (n = a[0], a.length > 1)var r = a[1];
            var l = validatorMap[n];
            if (!l)return !0;
            l = "array" === typeOf(l) ? l : ["", l], h && (o = h.split("&&"), o = o[s] || "");
            var c = {el: e.getNext(".caution"), msg: o || ("function" === typeOf(l[0]) ? l[0](e, e.get("value"), r) : l[0])};
            "bottom" == e.get("where") && (c = {el: e.getParent().getElement(".caution"), msg: o || ("function" === typeOf(l[0]) ? l[0](e, e.get("value"), r) : l[0])}), l = l[1] || function () {
                return !0
            };
            var d = ["input", "select", "textarea"].contains(e.get("tag"));
            if (l(e, e.get("value"), e.type, t.match("[vtype]") || t.match("[pattern]") ? i || t.getParent("form") || t.getParent() : t, r))return c.el && e.retrieve("tips_instance", {
                hide: function () {
                }
            }).hide(!0), d && e.removeClass("caution-input"), !0;
            if (c.el && c.el.destroy(), c.msg && formTips.error(c.msg, e).store(), e.bindEvent !== !1) {
                var p = d ? "onblur" : "onmouseout";
                e[p] = function (e) {
                    var i = e || window.event;
                    /mouseout$/i.test(i.type) && this.contains($(i.target || i.srcElement)) || (validate(this, "", t.match("[vtype]") || t.match("[pattern]") ? t.getParent("form") || t.getParent() : t), c.el && this.retrieve("tips_instance", {
                        hide: function () {
                        }
                    }).hide(!0), d && this.removeClass("caution-input")), this[p] = null
                }
            }
            return d && e.addClass("caution-input"), !1
        });
        c || s.push(e)
    }), s.length ? (s.shift().focus(), !1) : !0
}, formTips = new Class({
    Implements: Options, options: {form: "inline", type: "error", "class": "notice-inline", msg: "", target: document.body, destroy: !1, position: ["ct", "cb"], offset: [0, -9], intoView: !0, autohide: 3}, initialize: function (t) {
        return this.setOptions(t), this.hidden = !0, this
    }, toElement: function () {
        if (!this.element) {
            var t = this.options;
            this.uid = t.target.get("uid"), this.uid++;
            var e = "inline" == t.form ? "span" : "div", i = "_build_tips_" + (t.form ? t.form : "") + "_" + t.type + "_" + this.uid;
            this.element = t.single && document.id(i) ? document.id(i) : new Element(e, {
                id: i,
                "class": "caution " + t.type + " " + t["class"],
                style: "display:none;",
                html: '<q class="icon">' + ("success" === t.type ? "&#x25;" : "&#x21;") + '</q><span class="caution-content"></span>'
            }), this.element.inject(t.target, t.where)
        }
        return this.element
    }, store: function (t) {
        return ($(t) || this.options.target).store("tips_instance", this), this
    }, eliminate: function (t) {
        return ($(t) || this.options.target).eliminate("tips_instance"), this
    }, position: function (t) {
        return this.element || document.id(this), t = {target: t.target, from: "array" == tyeOf(t.position) ? t.position[0] : "cb", to: "array" == tyeOf(t.position) ? t.position[0] : t.position, offset: t.offset}, this.element.position(t)
    }, show: function (t, e) {
        if ("object" == typeOf(t) && (e = t, t = e.msg), !this.hidden)return this;
        if (e = Object.merge(this.options, e || {}), this.element || document.id(this), e.form && "inline" != e.form && this.element.position(e), e.intoView)try {
            new Fx.Scroll(document, {link: "cancel", duration: 300}).toElementEdge(this.element)
        } catch (i) {
        }
        return t && (this.element.getElement(".caution-content").innerHTML = t), this.element.show(), this.hidden = !1, !isNaN(e.autohide) && 0 < e.autohide && (clearTimeout(this.timer), this.timer = this.hide.delay(1e3 * e.autohide, this)), this.options.store ? this.store(this.options.store) : this
    }, hide: function (t) {
        return t = t || this.options.destroy, this.hidden ? this : (this.element || document.id(this), !1 !== t ? (this.element.destroy(), this.element = null) : this.element.hide(), this.hidden = !0, this.eliminate(this.options.store))
    }
}).extend({
    tip: function (t, e) {
        return new formTips({type: "notice", target: t || document.body, where: "after", autohide: 0}).show(e)
    }, error: function (t, e, i) {
        return "bottom" == e.get("where") ? new formTips({type: "error", target: e.getParent() || document.body, where: "bottom", autohide: 0}).show(t, i) : new formTips({type: "error", target: e || document.body, where: "after", autohide: 0}).show(t, i)
    }, success: function (t, e, i) {
        return new formTips({type: "success", target: e || document.body, where: "after", autohide: 0}).show(t, i)
    }, warn: function (t, e, i) {
        return new formTips({type: "warn", target: e || document.body, where: "top", autohide: 0, "class": "caution-inline", single: !0, store: !0}).show(t, i)
    }
}), passwordStrength = function (t, e, i) {
    var n = /[A-Z]/g, s = RegExp("(.{" + parseInt(t.length / 2) + ",})", "g"), o = "poor", o = -1, o = !t || 6 > t.length ? -1 : parseInt(t.length / 6) - 1;
    switch (t.match(s) && o--, (t.match(/[a-z]/g) || t.match(n)) && o++, t.match(/\d/g) && o++, t.match(/[\W_]/g) && o++, 6 < t.length && 2 > o && o++, o) {
        case-1:
        case 0:
        case 1:
            o = "poor";
            break;
        case 2:
            o = "weak";
            break;
        case 3:
            o = "good";
            break;
        default:
            o = "strong"
    }
    e.className = (i ? i + " " : "") + "password-" + o
}.extend({
    init: function (t, e) {
        Array.from(t).each(function (t) {
            if (t && (e = e ? t.parentNode.getElement(e) : t.getNext())) {
                e.style.visibility = "visible";
                var i = e.className;
                t.addEvent("inputchange", function (t) {
                    t = this.value, passwordStrength.prev !== t && passwordStrength(t, e, i), passwordStrength.prev = t
                })
            }
        })
    }
}), Placeholder = {
    support: function () {
        return "placeholder"in document.createElement("input")
    }(), className: "placeholder", init: function () {
        this.support || this.create($$("input, textarea"))
    }, build: function (t, e) {
        var i = t.getParent(), n = Placeholder;
        return "static" == i.getStyle("position") && i.setStyle("position", "relative"), t.getPrevious("." + this.className) || new Element("span." + this.className, {html: e, style: "visibility:hidden;"}).inject(t, "before").position({
            target: t,
            from: "lc",
            to: "lc",
            offset: {x: 4},
            offsetParent: !0
        }).addEvent("click", function (e) {
            n.hide(this), t.focus()
        })
    }, create: function (t) {
        var e = this;
        Array.from(t).each(function (t) {
            if (!e.support && t.get && t.get("placeholder")) {
                var i = t.get("placeholder");
                t.store("placeholder", e.build(t, i)), e.show(t), t.addEvents({
                    focusin: function (t) {
                        e.hide(this)
                    }, focusout: function (t) {
                        e.show(this)
                    }
                })
            }
        })
    }, show: function (t) {
        !this.support && "" === t.value && t.isVisible() && "hidden" !== t.getStyle("visibility") && t.retrieve("placeholder").setStyle("visibility", "visible")
    }, hide: function (t) {
        this.support || t.retrieve("placeholder", t).setStyle("visibility", "hidden")
    }
};
window.addEvent("domready", function (t) {
    document.forms.length && (passwordStrength.init($$("form .auto-password-check-handle")), changeVerify($$("form .auto-change-verify-handle"), !0), $$("form .action-remember-account").each(function (t) {
        t.addEvent("change", function (t) {
            this.checked ? Memory.set("sign.remember", "1", 365) : Memory.set("sign.remember", "0", 365)
        }).fireEvent("change")
    }), $$("form .action-auto-signin").addEvent("change", function (t) {
        this.checked ? Memory.set("sign.auto", "1", 14) : Memory.clean("sign.auto")
    })), Placeholder.init()
}), function () {
    this.Sync = new Class({
        Extends: Request.HTML, options: {disabled: "disabled", evalScripts: !0, hideDelay: 3, showMessage: !0, position: "before", tipCls: "-tip", ajaxTip: "ajax-tip"}, initialize: function (t, e) {
            (this.sponsor = t) && (e = this._getOptions(t, e)), this.parent(e)
        }, _getOptions: function (t, e) {
            e = e || {};
            var i;
            try {
                i = JSON.decode(t.get("data-ajax-config")) || {}
            } catch (n) {
                i = {}
            }
            var s;
            return "submit" === t.type && (s = this.dataForm = t.getParent("form")), s = s ? {data: s.toQueryString() + "&response_json=true", url: s.action, method: s.method || "post"} : {
                url: t.get("href"),
                data: "response_json=true",
                method: "get"
            }, i = Object.merge(s, e, t.retrieve("_ajax_config", {}), i)
        }, _defaultState: function () {
            this.sponsor && this.sponsor.removeClass(this.options.disabled)
        }, onFailure: function () {
            this._defaultState(), this.parent()
        }, _getCache: function (t) {
            return t.retrieve("ajax_cache", !1)
        }, _clearCache: function (t) {
            t.eliminate("ajax_cache")
        }, _setCache: function (t, e) {
            t.store("ajax_cache", e)
        }, _progressCache: function (t) {
            return t = this._getCache(t), this.options.syncCache && t ? (t.success(t.response.data), !0) : !1
        }, success: function (t, e) {
            return this.response.data = t, /text\/jcmd/.test(this.getHeader("Content-type")) ? this._jsonSuccess(t) : ["update", "append", "filter"].some(function (t) {
                return this.options[t]
            }, this) ? this.parent(t, e) : this.onSuccess(this.processScripts(t), e)
        }, _jsonSuccess: function (t) {
            try {
                t = this.response.json = JSON.decode(t, this.options.secure)
            } catch (e) {
            }
            this.onSuccess(t)
        }, onSuccess: function (t) {
            this._defaultState(), this.options.syncCache && this.sponsor && this._setCache(this.sponsor, this), this.response.json && this._progress(t), this.parent(arguments)
        }, _progress: function (t) {
            function e() {
                n && ("back" == n ? history.back() : "reload" == n ? location.reload() : location.href = n)
            }

            if (t) {
                if (this.options.progress)return this.options.progress.call(this, t);
                var i, n = t.redirect;
                this.options.showMessage && !["error", "success"].every(function (n) {
                    return (i = t[n]) ? (this.options.inject ? n === this.options.tipHidden ? this._clearTip(n, i) : this._injectTip(n, i) : Message(i, n, this.options.hideDelay, e), !1) : !0
                }, this) || e()
            }
        }, _clearTip: function () {
            this.inject && this.tipElem && this.tipElem.destroy()
        }, _injectTip: function (t, e) {
            var i = this.options, n = this.inject = document.id(i.inject), s = i.position, o = i.ajaxTip;
            if (t += i.tipCls, n) {
                if (i = n.getParent(), this.tipElem = i.getElement("." + o), i && this.tipElem)return this.tipElem.set("html", e);
                new Element("div." + t + "." + o, {html: e}).inject(n, s)
            }
        }, _request: function (t) {
            t.addClass(this.options.disabled)
        }, _isCheck: function (t) {
            return t = t || {}, t = this.dataForm || t.data || this.options.data, "element" !== typeOf(t) || validate(t) ? !0 : !1
        }, send: function (t) {
            var e = this.sponsor;
            if (e) {
                if (e.hasClass(this.options.disabled) || !this._isCheck(t) || this._progressCache(e))return;
                this._request(e)
            }
            this.parent(t)
        }
    }), this.async = function (t, e, i) {
        if (t.hasClass("disabled"))return !1;
        if ("object" === typeOf(e))i = e; else if ("element" === typeOf(e)) {
            if (!validate(e))return t.removeClass("disabled"), !1;
            if (i && !1 === i.async)return
        } else if (e = t.retrieve("ajax_cache", !1))return e.send();
        new Sync(t, i).send()
    }, this.Event_Group = {_request: {fn: async}}, $(document.html).addEvent("click", function (t) {
        var e = $(t.target), i = e.nearest("type", "submit") || e.nearest("rel");
        if (i && 9 !== i.nodeType && !i.disabled) {
            var n = i.getParent("form");
            if (!n || "false" !== n.get("async")) {
                if ("submit" === i.type && n && n.get("target"))return async(i, n, {async: !1});
                if ("submit" === i.type && "_request" !== i.get("rel"))return async(i, n);
                var e = i.get("rel"), s = Event_Group[e];
                if (s) {
                    var o = s.fn, s = s.loader;
                    if (t.preventDefault(), $(i).get && $(i).get(e))return i;
                    s ? $LAB.script(s).wait(function () {
                        o && o(i, n)
                    }) : o && o(i, n)
                }
            }
        }
    })
}();
var Popup = new Class({
    Implements: [Events, Options],
    options: {
        title: LANG_shopwidgets.tip,
        show: !0,
        minHeight: 220,
        minWidth: 250,
        effect: {style: "opacity", duration: 400, from: 0, to: 1, maskto: .7},
        position: {target: document.body, from: {x: "center", y: "center"}, to: {x: "center", y: "center"}, offset: {x: 0, y: 0}},
        frameTpl: '<iframe allowtransparency="allowtransparency" align="middle" frameborder="0" height="100%" width="100%" scrolling="auto" src="about:blank">请使用支持iframe框架的浏览器。</iframe>',
        ajaxTpl: '<div class="loading">loading...</div>',
        asyncOptions: {method: "get", cache: !0},
        component: {container: "popup-container", body: "popup-body", header: "popup-header", close: "popup-btn-close", content: "popup-content", mask: "mask"}
    },
    initialize: function (t, e) {
        if (t) {
            this.target = t, this.doc = document.id(document.body), this.setOptions(e), e = this.options;
            var i = e.asyncOptions || {}, n = this.container = this.build(e.template, t), s = new Element("div");
            this.body = n.getElement("." + e.component.body) || s, this.header = n.getElement("." + e.component.header) || s, this.title = this.header.getElement("h2") || s, this.close = n.getElements("." + e.component.close), this.content = n.getElement("." + e.component.content) || s, this.zIndex = 50000, e.width && !isNaN(e.width) && (e.width = 1 >= e.width && 0 < e.width ? e.width * window.getSize().x : e.width.toInt()), e.height && !isNaN(e.height) && (e.height = 1 >= e.height && 0 < e.height ? e.height * window.getSize().y : e.height.toInt()), this.size = {
                x: e.width || "",
                y: e.height || ""
            }, e.title || this.header.getElement("h2") && this.header.getElement("h2").destroy(), n.retrieve("instance") || this.body.setStyles({
                width: this.size.x,
                height: this.size.y
            }), this.fireEvent("load", this), "string" === typeOf(t) && ("ajax" === e.async ? this.requestCache(Object.merge({
                url: t + "",
                update: this.content
            }, i)) : (n = i.data ? t + (1 < t.indexOf("?") ? "&" : "?") + i.data : t + "", this.content.getElement("iframe").set("src", n).addEvent("load", (i.onSuccess || function () {
            }).bind(this)))), $$("div[rel=mask]." + e.component.mask)[0] && (e.modal = !1), e.modal && (i = e.effect ? {style: e.effect.style, duration: e.effect.duration, from: e.effect.from, to: e.modal.opacity || e.effect.maskto} : !1, this.mask = new Mask({
                target: e.modal.target || e.modal,
                "class": e.modal["class"] || e.component.mask,
                zIndex: this.zIndex++,
                effect: i
            })), this.hidden = !0, this.attach()
        }
    },
    attach: function () {
        return this.options.show && this.show(), this.container.retrieve("instance") || this.container.store("instance", this).addEvent("click:relay(." + this.options.component.close + ")", function (t) {
            this.hide()
        }.bind(this)), this
    },
    build: function (t, e) {
        var i, n = this.options, s = n.id ? document.id(n.id) : document.getElement("[data-single=true]." + n.component.container);
        return "element" === typeOf(e) ? i = e.tagName.test(/^(?:IMG|OBJECT|SCRIPT)$/) ? e : e.innerHTML : "string" === typeOf(e) && (i = "ajax" === n.async ? n.ajaxTpl : n.frameTpl), n.single && s ? ("element" === typeOf(e) && (s.retrieve("instance").content.innerHTML = i), s) : (t = '<div class="{container}" {id} data-single="' + !!n.single + '" tabindex="1">' + this.getTemplate(t) + "</div>", Object.merge(n.component, {
            title: n.title,
            id: n.id ? 'id="' + n.id + '"' : "",
            main: i
        }), new Element("div", {html: t.substitute(n.component)}).getFirst().inject(this.doc))
    },
    getTemplate: function (t, e) {
        var i = this.options;
        if ((t = t || i.template) && "string" === typeOf(t)) {
            if (!document.id(t))return t;
            t = document.id(t)
        }
        if ("element" === typeOf(t) && /^(?:script|textarea|template)$/i.test(t.tagName))return document.id(t).get("value") || document.id(t).get("html");
        e = e || i.type;
        var n = '<div class="{body}">;<div class="{header}">;<h2>{title}</h2>;<span><button type="button" class="{close}" title="关闭"><i>×</i></button></span>;</div>;<div class="{content}">{main}</div>;</div>'.split(";");
        return "nohead" === e ? n[1] = n[2] = n[3] = n[4] = "" : "notitle" === e ? n[2] = "" : ("noclose" === e || i.autoHide) && (n[3] = ""), n.join("\n")
    },
    show: function () {
        if (!this.hidden)return this;
        this.container.setStyle("display", "block").setStyle("z-index", this.zIndex++), this.position(), Browser.ie6 && this.options.useIframeShim && new Element("iframe", {
            frameborder: 0,
            src: "about:blank",
            style: "position:absolute;z-index:-1;border:0 none;filter:alpha(opacity=0);top:" + (-this.container.getPatch().y || 0) + "px;left:" + (-this.container.getPatch().x || 0) + "px;width:" + (this.container.getSize().x || 0) + "px;height:" + (this.container.getSize().y || 0) + "px;"
        }).inject(this.container);
        var t = this.options.effect;
        return t ? (!0 !== t && "opacity" !== t.style || this.container.setStyle("opacity", t.from || 0).setStyle("visibility", "visible"), new Fx.Tween(this.container, {
            duration: t.duration || 400, onComplete: function () {
                this.container.focus()
            }.bind(this)
        }).start(t.style || "opacity", t.from || 0, t.to || 1)) : this.container.focus(), this.hidden = !1, this.fireEvent("show", this), this.mask && this.mask.show(), this.options.autoHide && (this.container.timer = this.hide.delay(1e3 * this.options.autoHide.toInt(), this)), this
    },
    hide: function () {
        if (this.hidden)return this;
        var t = this.container.retrieve("resize_position");
        return t && window.removeEvent("resize", t), this.fireEvent("close", this), this.options.pins && this.container.pin(!1, !1, !1), t = this.options.effect, this.options.single ? t ? this.stopTimer().container.setStyles({
            display: "none",
            opacity: 0,
            visibility: "hidden"
        }) : this.container.setStyle("display", "none") : (t ? this.container.timer = new Fx.Tween(this.container, {
            duration: t.duration || 400, link: "ignore", onComplete: function () {
                this.container.destroy()
            }.bind(this)
        }).start(t.style || "opacity", t.to || 1, t.from || 0) : this.container.destroy(), document.id(this.container).eliminate("instance")), this.hidden = !0, this.container.store("instance", this), this.hideMask()
    },
    stopTimer: function () {
        return this.container.timer && (clearTimeout(this.container.timer), this.container.timer = null), this
    },
    hideMask: function () {
        return this.options.modal && $$("[data-single]").retrieve("instance").every(function (t) {
            return !t || !t.close.length || t.hidden
        }) && this.mask.hide(), this
    },
    hideAll: function () {
        this.hide();
        var t = $$("[data-single]").retrieve("instance");
        t.length && t.each(function (t) {
            t && t.hide()
        })
    },
    position: function () {
        var t, e = this.options;
        return !this.size.x && Browser.ie && 8 > Browser.version && this.container.getSize().x >= this.doc.getSize().x && document.id(this.body).setStyle("width", e.minWidth.toInt() - this.container.getPatch().x), !this.size.y && Browser.ie && 8 > Browser.version && this.container.getSize().y >= this.doc.getSize().y && document.id(this.body).setStyle("height", Math.min(e.minHeight.toInt(), this.doc.getSize().y) - this.container.getPatch().y), this.size.y ? t = this.container : this.container.getSize().y >= this.doc.getSize().y && (t = this.doc), "element" === typeOf(t) && this.setHeight(t), this.container.position(e.position), e.pins && this.container.pin(), this
    },
    setHeight: function (t) {
        t = t || this.container, this.content.setStyle("height", (!this.size.y && Browser.ie && 8 > Browser.version ? this.body.getStyle("height").toInt() : t.getSize().y - this.container.getPatch().y) - document.id(this.body).getPatch().y - document.id(this.header).getOuterSize().y - this.content.getPatch().y)
    },
    setTitle: function (t) {
        this.title.set("html", t)
    },
    requestCache: function (t) {
        var e;
        return t ? t.target && t.cache && (e = t.target.retrieve("request:cache")) ? e.success(e.response.text) : (e = new Request.HTML(t).send(), t.target && t.target.store("request:cache", e), this) : null
    },
    toElement: function () {
        return this.container
    }
});
Element.implement({
    fixed: function (t) {
        t = [t].flatten() || ["top", "left"];
        var e = t.contains("left"), i = t.contains("top");
        if (Browser.ie6) {
            var n = window.getScroll(), s = this.getPosition().x - n.x, o = this.getPosition().y - n.y;
            t = function () {
                e && this.getStyle("left").toInt() >= document.body.clientWidth || i && this.getStyle("top").toInt() >= document.body.clientHeight || (n = window.getScroll(), this.set("morph", {duration: 200, transition: Fx.Transitions.Quart.easeOut}).morph({
                    left: e ? s + n.x : null,
                    top: i ? o + n.y : null
                }))
            }.bind(this), window.addEvent("scroll", t)
        }
    }, pin: function (t, e, i, n) {
        "object" === typeOf(t) && (n = t.pos, i = t.restore, e = t.forceScroll, t = t.enable), n = n ? [n].flatten() : ["top", "left", "bottom", "right"];
        var s = n.contains("left");
        if (!1 !== t) {
            if (!this.retrieve("pin:_pinned")) {
                if (t = window.getScroll(), this.store("pin:_original", this.getStyles("position", n)), n = this.getPosition(Browser.ie6 ? this.getOffsetParent() : document.body), n = {left: s ? n.x - t.x : "", top: n.y - t.y}, Browser.ie6) {
                    e && this.setPosition({x: this.getOffsets().x + t.x, y: this.getOffsets().y + t.y}), "static" == this.getStyle("position") && this.setStyle("position", "absolute");
                    var o = this.getPosition().x - t.x, a = this.getPosition().y - t.y;
                    e = function () {
                        if (this.retrieve("pin:_pinned") && !(s && this.getStyle("left").toInt() >= document.body.clientWidth || this.getStyle("top").toInt() >= document.body.clientHeight)) {
                            var t = window.getScroll();
                            this.setStyles({left: s ? o + t.x : "", top: a + t.y})
                        }
                    }.bind(this), this.store("pin:_scrollFixer", e), window.addEvent("scroll", e)
                } else this.setStyle("position", "fixed").setStyles(n);
                this.store("pin:_pinned", !0)
            }
        } else {
            if (!this.retrieve("pin:_pinned"))return this;
            i && this.setStyles(this.retrieve("pin:_original", {})), this.eliminate("pin:_original"), this.store("pin:_pinned", !1), Browser.ie6 && (window.removeEvent("scroll", this.retrieve("pin:_scrollFixer")), this.eliminate("pin:_scrollFixer"))
        }
        return this
    }, togglePin: function () {
        return this.pin(!this.retrieve("pin:_pinned"))
    }
});
var Mask = new Class({
    Implements: [Options, Events], options: {"class": "mask", effect: {style: "opacity", duration: 300, from: 0, to: .7}}, initialize: function (t) {
        this.target = t && document.id(t.target) || document.id(document.body), this.setOptions(t), this.element = $$("div[rel=mask]." + this.options["class"])[0] || new Element("div[rel=mask]." + this.options["class"]).inject(this.options.injectTo || (this.target == window ? document.body : this.target)), this.options.html && this.element.set("html", this.options.html.stripScripts()), this.hidden = !0
    }, setSize: function () {
        this.target && document.id(this.element).isVisible() && this.element.setStyles({
            width: this.options.width || Math.max(this.target.getScrollSize().x, this.target.getSize().x, this.target.clientWidth || 0),
            height: this.options.height || Math.max(this.target.getScrollSize().y, this.target.getSize().y, this.target.clientHeight || 0)
        })
    }, position: function () {
        this.element.position({target: this.target, resize: this.options.resize})
    }, show: function () {
        if (this.hidden) {
            this.target == window && document.html.setStyles({
                height: "100%",
                overflow: "hidden"
            }), window.addEvent("resize", this.setSize.bind(this)), this.setSize(), this.element.setStyle("display", "block"), this.options.zIndex && this.element.setStyle("z-index", this.options.zIndex), this.options.html && this.element.setStyle("line-height", this.element.getSize().y), this.options.position && this.position(), this.options.pins && this.element.pin();
            var t = this.options.effect;
            return t ? (!0 !== t && "opacity" != t.style || this.element.setStyle("opacity", t.from || 0).setStyle("visibility", "visible"), new Fx.Tween(this.element, {duration: t.duration || 400}).start(t.style || "opacity", t.from || 0, t.to)) : 0 === this.element.get("opacity") && this.element.set("opacity", "").setStyle("visibility", ""), this.hidden = !1, this
        }
    }, hide: function () {
        if (!this.hidden) {
            window.removeEvent("resize", this.setSize.bind(this));
            var t = this.element.retrieve("resize_position");
            return t && window.removeEvent("resize", t), (t = this.options.effect) ? new Fx.Tween(this.element, {
                duration: t.duration || 400, onComplete: function () {
                    this.element.destroy()
                }.bind(this)
            }).start(t.style || "opacity", t.to, t.from || 0) : this.element.destroy(), this.target == window && document.html.setStyles({height: "", overflow: ""}), this.hidden = !0, this
        }
    }, toggle: function () {
        return this[this.hidden ? "show" : "hide"]()
    }, toElement: function () {
        return this.element
    }
});
Element.Properties.mask = {
    set: function (t) {
        var e = this.retrieve("mask");
        return e && ((e = document.id(e.element)) && e.destroy(), this.eliminate("mask")), this.store("mask:options", t)
    }, get: function () {
        var t = this.retrieve("mask");
        return t || (t = new Mask(Object.merge(this.retrieve("mask:options") || {}, {target: this})), this.store("mask", t)), t
    }
}, Element.implement({
    mask: function (t) {
        return t && this.set("mask", t), this.get("mask").show(), this
    }, unmask: function () {
        return this.get("mask").hide(), this
    }
});
var Dialog = new Class({
    Extends: Popup, initialize: function (t, e) {
        e = Object.merge({width: 330, useIframeShim: !0, template: document.id("popup_template"), position: {intoView: !0}}, e || {}), this.parent(t, e)
    }
}).extend({
    instance: function (t, e) {
        return new Dialog(t, Object.merge({show: !1}, e || {}))
    }, alert: function () {
        var t = Array.from(arguments).link({msg: Type.isString, callback: Type.isFunction, options: Type.isObject}), e = t.options || {};
        Dialog.instance(new Element("div", {html: '<div class="pop-attention-main"><div class="figure"><dfn class="alert">!</dfn><span class="mark">' + t.msg + '</span></div><div class="bottom"><button type="button" class="btn btn-caution action-confirm"><span><span>' + (e.confirmText || "确定") + "</span></span></button> </div></div>"}), Object.merge({
            width: 350,
            title: "友情提示",
            modal: window,
            pins: !0,
            single: !1,
            effect: !1,
            position: {intoView: !0},
            component: {container: "alert-container", header: "alert-header", close: "alert-btn-close", body: "alert-body", content: "alert-content"},
            onLoad: function () {
                this.content.getElements(".action-confirm").addEvent("click", function (e) {
                    this.hide(), t.callback && t.callback.call(this)
                }.bind(this))
            }
        }, e)).show()
    }, confirm: function () {
        var t = Array.from(arguments).link({msg: Type.isString, callback: Type.isFunction, options: Type.isObject}), e = t.options || {};
        Dialog.instance(new Element("div", {html: '<div class="pop-attention-main"><div class="figure"><dfn class="confirm">!</dfn><span class="mark">' + t.msg + '</span></div><div class="bottom"><button type="button" class="btn btn-caution action-confirm" data-return="1"><span><span>' + (e.confirmText || "确定") + '</span></span></button><button type="button" class="btn btn-simple action-cancel" data-return="0"><span><span>' + (e.cancelText || "取消") + "</span></span></button></div></div>"}), Object.merge({
            width: 350,
            title: "友情提示",
            modal: window,
            pins: !0,
            single: !1,
            effect: !1,
            position: {intoView: !0},
            component: {container: "alert-container", header: "alert-header", close: "alert-btn-close", body: "alert-body", content: "alert-content"},
            onLoad: function () {
                var e, i = this;
                this.content.getElements("[data-return]").addEvent("click", function (n) {
                    e = !!this.get("data-return").toInt(), i.hide(), t.callback && t.callback.call(this, e)
                })
            }
        }, e)).show()
    }, tips: function () {
        var t = Array.from(arguments).link({element: Type.isElement, msg: Type.isString, callback: Type.isFunction, options: Type.isObject}), e = t.options || {}, i = document.id(t.element);
        Dialog.instance(new Element("div", {html: '<span class="icon">&#x24;</span><p>' + t.msg + '</p><div class="bottom"><button type="button" class="btn btn-caution btn-small action-confirm" data-return="1"><span><span>' + (e.confirmText || "确定") + '</span></span></button><button type="button" class="btn btn-simple btn-small action-cancel" data-return="0"><span><span>' + (e.cancelText || "取消") + "</span></span></button></div>"}), Object.merge({
            width: "",
            modal: !1,
            template: '<div class="{body}"><div class="{content}">{main}</div></div>',
            single: !0,
            effect: !1,
            position: {target: i, from: {x: "c", y: "b"}, to: {x: "c", y: "t"}, offset: {x: 0, y: -2}, intoView: !0, resize: !0},
            component: {container: "dialog-tips-container", body: "dialog-tips-body", content: "dialog-tips-content"},
            onLoad: function () {
                var e, i = this;
                this.content.getElements("[data-return]").removeEvents("click").addEvent("click", function (n) {
                    e = !!this.get("data-return").toInt(), t.callback && t.callback.call(this, e), i.hide()
                }), this.arrow = Arrow(this.container, {to: this.options.position.from}), this.options.position.offset = this.arrow.setTargetOffset(this.options.position), this.options.eventTarget && this.container.addEvent("outerclick", function (t) {
                    t.target != this.options.eventTarget && this.hide()
                }.bind(this))
            },
            onShow: function () {
                this.arrow.show()
            },
            onClose: function () {
                this.container.removeEvents("outerclick")
            }
        }, e)).show()
    }, iframe: function (t, e) {
        return Dialog.instance(t, Object.merge({async: "iframe"}, e || {})).show()
    }, ajax: function (t, e) {
        return Dialog.instance(t, Object.merge({async: "ajax"}, e || {})).show()
    }, image: function (t, e) {
        return Dialog.instance(new Element("div", {html: '<img src="' + t + '" />'}), Object.merge({
            template: '<div class="{body}"><span><button type="button" class="{close}" title="关闭"><i>×</i></button></span><div class="{content}">{main}</div></div>',
            width: "",
            height: "",
            modal: !0,
            single: !0,
            component: {container: "image-container", close: "image-btn-close", content: "image-content"}
        }, e || {})).show()
    }
}), popTip = new Class({
    Extends: Popup, initialize: function (t, e) {
        if (t) {
            e = e || {};
            var i = new Element("div[html=" + t + "]"), n = e.relative || document.body, s = /^(?:body|html)$/i.test(n.tagName.toLowerCase()), o = s ? "center" : 0, a = s ? 0 : "top", r = !!s, s = s ? 0 : "bottom";
            this.options = Object.merge(this.options, {
                type: e.type || "nofoot",
                template: e.template || document.id("xtip_template"),
                modal: !1,
                pins: r,
                single: !1,
                effect: !0,
                position: {target: n, from: {x: 0, y: s}, to: {x: o, y: a}, offset: {x: e.offset && e.offset.x ? e.offset.x : 0, y: e.offset && e.offset.y ? e.offset.y : 0}, intoView: void 0 !== e.intoView ? e.intoView : !0},
                component: {container: "xtip-container", body: "xtip-body", header: "xtip-header", close: "xtip-btn-close", content: "xtip-content"}
            }), this.parent(i, e)
        }
    }
}), Tips = new Class({
    Implements: Options,
    options: {
        type: "autohide", offset: {x: 0, y: -9}, hideDelay: 2e3, position: "topCenter", inject: document.body,
    where:"bottom","class":"xtips-container",arrow:!0,text:null},initialize:function(){var t=Array.from(arguments).link({element:Type.isElement,msg:Type.isString,options:Type.isObject}),e=this.elements=document.id(t.element)||$$("[data-tips]");return!e||"elements"===typeOf(e)&&!e.length?null:(this.setOptions(t.options),this.options.inject=this.options.inject||document.body,void this.build(t.msg))},build:function(t){var e="inline"==this.options.type?"span":"div",i="<"+e+' class="xtips-content"></'+e+">";return this.container=document.id("xtips_container")||new Element(e+"#xtips_container."+this.options["class"],{html:i}).inject("inline"==this.options.type&&typeOf("element"==this.elements)?this.elements:document.id(this.options.inject),this.options.where).store("tips",this),this.content=this.container.getElement(".xtips-content"),this.msg=t||"",this},attach:function(t){return"mouse"==t?Array.from(this.elements).each(function(t){t.addEvents({mouseenter:this.show.bind(this,[t,this.msg,!1]),mouseleave:this.hide.bind(this)})}):"click"==t&&Array.from(this.elements).each(function(t){t.addEvent("click",function(){this.hidden?this.show(t,this.msg):this.hide()})}),this},show:function(t,e,i){if(i=i||this.options.type,e||"element"!==typeOf(this.elements)||(e=this.elements),t=t||this.msg||e.get("data-tips")||e.retrieve("tips:text"),!e||!t||!this.container)return this;"tooltip"!==this.options.type&&(t='<q class="icon">&#x24;</q>'+t),this.content.set("html",t),t=this.options.position.toLowerCase();var n=e.getPosition(),s=this.container.getSize(),o=e.getSize(),a=e.get("data-tips-config"),a=JSON.decode(a)||{},r={};return"inline"!==this.options.type&&(-1!=["rightcenter","rc","cr"].indexOf(t)?r={left:n.x+o.x,top:Math.max(n.y+(s.y-o.y)/2,0)}:-1!=["topcenter","tc","ct"].indexOf(t)?r={left:Math.max(n.x-(s.x-o.x)/2+this.options.offset.x||0,0),top:Math.max(n.y-s.y+this.options.offset.y||0,0)}:-1!=["bottomleft","bl","lb"].indexOf(t)&&(r={left:Math.max(n.x||0,0),top:Math.max(n.y+o.y+this.options.offset.y||0,0)})),r=Object.merge({display:"",opacity:1,visibility:"visible",width:a.width?a.width:s.x>window.getSize().x?window.getSize().x:""},r),this.container.setStyles(r),this.options.arrow&&(t={topCenter:{x:"b",y:"c"},rightCenter:{x:"l",y:"c"},bottomCenter:{x:"t",y:"c"},leftCenter:{x:"r",y:"c"}},Arrow(this.container,{to:t[this.options.position]}).show()),this.hidden=!1,"autohide"==i&&(this.stopTimer(e),e.timer=this.hide.delay(this.options.hideDelay,this)),this},stopTimer:function(t){return t.timer&&(clearTimeout(t.timer),t.timer=null),this},hide:function(){return this.container.setStyle("opacity",0).setStyle("visibility","hidden"),this.hidden=!0,this}});Element.implement({tips:function(t,e){return new Tips(this).show(t,this,e),this}});var Warn=function(t,e,i){(t=document.id(t))&&(this.msg=e||"",i=i||"warn-message",this.container=document.id("warn_message")?document.id("warn_message").set("html",this.msg):new Element("span#warn_message."+i,{html:this.msg}).inject(t,"after"))};Warn.prototype.show=function(t){this.container.set("html",t||this.msg||"").show("block")},Warn.prototype.hide=function(){this.container.hide()};var ToolTip=new Class({Implements:[Events,Options],Binds:["hide"],timer:null,options:{autohide:!0,offset:12,hideDelay:1e3,"class":"tooltip",arrow:"arrow",position:{from:"cb",to:"ct",offset:{x:0,y:-2}},text:null},initialize:function(t,e){this.element=t,this.setOptions(e),this.toolTip=new Element("div."+this.options["class"]+"-container",{html:'<div class="'+this.options["class"]+'-content">'+this.options.text+"</div>"}).hide().inject(document.body),this.content=this.toolTip.getElement("."+this.options["class"]+"-content"),this.options.arrow&&(this.arrow=Arrow(this.toolTip,{"class":this.options.arrow,to:this.options.position.from}),this.options.position.offset=this.arrow.setTargetOffset(this.options.position)),[this.element,this.toolTip].each(function(t){t.addEvents({mouseenter:function(){this.options.autohide&&window.clearTimeout(this.timer)}.bind(this),mouseleave:function(){this.options.autohide&&(this.timer=this.hide.delay(this.options.hideDelay,this))}.bind(this)})},this)},hide:function(){var t;return this.toolTip.hide(),"element"==typeOf(t=this.toolTip.getElement("div.close"))&&t.destroy(),this.fireEvent("hide"),this.element.erase("data-tooltip-displayed"),this},position:function(){return this.toolTip.position(Object.merge(this.options.position,{target:this.element})),this},set:function(t){"element"==typeOf(t)?this.content.empty().grab(t):this.content.set("html",t),this.options.autohide||new Element('div.close[title="关闭"]').inject(this.toolTip,"top").addEvent("click",this.hide.bind(this))},show:function(){return this.element.get("data-tooltip-displayed")||(this.element.set("data-tooltip-displayed",!0),this.toolTip.show(),this.position(),this.arrow&&this.arrow.show(),this.fireEvent("show")),this}}).extend({instance:function(t,e,i){var n,s,o=["string","element"].contains(typeOf(e)),a=o?e:i||null;return e=o?i||{}:e,"object"==typeOf(n=document.retrieve("ToolTip.current"))&&n.hide(),null==(s=t.retrieve("ToolTip.instance"))?s=new ToolTip(t,e):s.setOptions(e),t.store("ToolTip.instance",s),document.store("ToolTip.current",s),a&&s.set(a),s}}),Arrow=function(t,e){e=Object.merge({target:document.body,"class":"arrow",to:"bc",offset:{x:0,y:0}},e||{}),"element"==typeOf(t)&&(e.target=t);var i="string"==typeof e["class"]?e["class"]:"arrow",n={b:i+"-bottom",t:i+"-top",l:i+"-left",r:i+"-right"};return e.position=Arrow.getCoordinate(e.to),i=new Element("div."+i+"."+n[e.position.x],{html:'<i class="below">◆</i><i class="above">◆</i>'}).inject(e.target).store("Arrow:position",e),i.show=function(){return this.setStyle("display","").position(e),this},i.position=function(t,e){var i,n;if(["string","element"].contains(typeOf(t))?(i=document.id(t),n=e):(n=t,i=document.id(n.target)),i){n=Object.merge({to:"bc",offset:{x:0,y:0}},n||this.retrieve("Arrow:position",{}));var s={c:{x:.5},m:{y:.5},r:{x:1},b:{y:1}},o=i.getSize();i=i.getPatch("border");var a=this.getSize(),r=n.position||Arrow.getCoordinate(n.to);return this.setStyles({left:s[r.y].x?(o.x-a.x-i.x)*s[r.y].x+n.offset.x:"",top:s[r.y].y?(o.y-a.y-i.y)*s[r.y].y+n.offset.y:""})}},i.setTargetOffset=function(t,e){"object"==typeof t&&t.to&&t.offset?(e=t.offset,t=t.to):e=e||{x:0,y:0},t=Arrow.getCoordinate(t);var i={t:["y",-1,"bottom"],b:["y",1,"top"],l:["x",-1,"right"],r:["x",1,"left"]};return e[i[t.x][0]]+=i[t.x][1]*this.getElement(".below").getStyle("border-"+i[t.x][2]+"-width").toInt(),e},i}.extend({getCoordinate:function(t){if("object"==typeof t&&(t.x||0===t.x)&&(t.y||0===t.y)){if(-1<"ltbr".indexOf(t.x)&&-1<"ltbrcm".indexOf(t.y))return t;if(-1<"cm".indexOf(t.x))return{x:t.y,y:t.x};t=t.x.toString()+t.y.toString()}t=t.toLowerCase();var e=t.match(/^c(enter)?|^m(iddle)?/g),i=t.match(/c(enter)?$|m(iddle)?$/g);return(e||i)&&(t=t.split(e?e[0]:i[0])[e?1:0],t+=t.test(/^l(eft)?|^r(ight)?/g)?"m":"c"),{x:t.test(/^l(eft)?|^0/)?"l":t.test(/^r(ight)?|^1(00%)?/)?"r":t.test(/^t(op)?/)?"t":"b",y:t.test(/l(eft)?$/)?"l":t.test(/r(ight)?$/)?"r":t.test(/t(op)?$|0$/)?"t":t.test(/b(ottom)?$|1(00%)?$/)?"b":t.test(/m(iddle)?$/)?"m":"c"}}});Message.show=function(t,e,i){Message(t||LANG_jstools.messageShow,"show",e,i)},Message.hide=function(t){t=t||"show",document.id("pop_message_"+t)&&document.id("pop_message_"+t).retrieve("instance").hide()},Message.error=function(t,e,i){return Message(t||LANG_jstools.messageError,"error",e,i)},Message.success=function(t,e,i){return Message(t||LANG_jstools.messageSuccess,"success",e,i)};var AutoPlay=new Class({options:{autoplay:!0,interval:3e3,pauseOnHover:!0},_autoInit:function(t){this.options.autoplay&&(this.autofn=t||function(){},this.autoEvent().startAutoplay())},autoEvent:function(){return this.options.pauseOnHover&&this.container&&this.container.addEvents({mouseenter:this.stopAutoplay.bind(this),mouseleave:function(){this.startAutoplay()}.bind(this)}),this},startAutoplay:function(){this.paused=!1,this.autoTimer=function(){this.paused||this.autofn()}.periodical(this.options.interval,this)},stopAutoplay:function(){this.autoTimer&&(clearInterval(this.autoTimer),this.autoTimer=void 0),this.paused=!0}}),LazyLoad=new Class({Implements:[Options,Events],options:{img:"data-src",textarea:"action-lazyload",lazyDataType:"textarea",execScript:!0,islazyload:!0,lazyEventType:"beforeSwitch",onAfter:function(){}},loadCustomLazyData:function(t,e){var i,n,s=this.options.textarea,o=this.options.img;this.options.islazyload&&Array.from(t).each(function(t){switch(e){case"img":n="IMG"===t.nodeName?[t]:t.getElements("img"),n.each(function(t){this.loadImgSrc(t,o)},this);break;default:(i=t.getElement("textarea"))&&i.hasClass(s)&&this.loadAreaData(i)}},this)},loadImgSrc:function(t,e,i){e=e||this.options.img;var n=t.getProperty(e);t.removeProperty(e),n&&t.src!=n&&imageReady(n,function(){t.src=n,i&&i()},function(){this.fireEvent("after",t)}.bind(this))},loadAreaData:function(t,e){var i=new Element("div").inject(t,"before");this.stripScripts(t.value,i),t.destroy(),e&&e()},isAllDone:function(){var t,e,i=this.options.lazyDataType,n=this.options[i],s="img"===i;if(i&&this.container)for(i=this.container.getElements(i),t=0,e=i.length;e>t;t++)if(s?i[t].get(n):i[t].hasClass(n))return!1;return!0},stripScripts:function(t,e){var i="",n=t.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(t,e){return i+=e+"\n",""});e.set("html",this.options.execScript?n:t),this.options.execScript&&Browser.exec(i)},_lazyloadInit:function(t){this.addEvent(this.options.lazyEventType,function(){var e="function"==typeOf(t)?t(arguments):t;this.loadCustomLazyData(e,this.options.lazyDataType),this.isAllDone()&&this.removeEvent(this.options.lazyEventType,arguments.callee)}.bind(this))}}),DataLazyLoad=new Class({Extends:LazyLoad,options:{containers:document,threshold:null,syncEl:null,config:{mod:"manual",diff:"default",placeholder:""}},initialize:function(t,e){this.setOptions(t),e=e||this.options.containers,this.containers=Array.from(e),this.containers.length&&(window.Shop&&(this.options.config.placeholder=Shop.url.placeholder),this.lazyinit())},lazyinit:function(){this.threshold=this.getThreshold(),this.filterItems().getItemsLength(),this.initLoadEvent()},filterItems:function(){var t=[],e=[];return this.containers.each(function(i){t=t.combine(i.getElements("img").filter(this.filterImg,this)),e=e.combine(i.getElements("textarea").filter(this.filterArea,this))},this),this.images=t,this.areas=e,this},filterImg:function(t){var e=this.options.img,i=t.getAttribute(e),n=this.threshold,s=this.options.config.placeholder;if("manual"===this.options.config.mod){if(i)return s&&(t.src=s),!0}else if($(t).getOffsets().y>n&&!i)return t.set(e,t.src),s?t.src=s:t.removeAttribute("src"),!0},filterArea:function(t){return t.hasClass(this.options.textarea)},initLoadEvent:function(){function t(){n.threshold=n.getThreshold(),e()}function e(){i||(i=function(){n.loadItems.call(n),n.getItemsLength()||s.removeEvents({scroll:e,resize:t}),i=null}.delay(100))}var i,n=this,s=window;s.addEvent("domready",this.loadItems.bind(this)),this.getItemsLength()&&s.addEvents({scroll:e,resize:t})},loadItems:function(){var t=this.options.syncEl;return t?this.loadsync(this[t],t):(this.initItems(this.images.concat(this.areas)),void this.fireEvent("callback"))},initItems:function(t){var e=window.getScroll().y,i=this.threshold+e,n={images:[],areas:[]},s={areas:"loadAreaData",images:"loadImgSrc"};t.each(function(t){var e="TEXTAREA"==t.tagName?"areas":"images";t=$(t),e&&"none"==t.getStyle("display")&&t.getParent(),t.getOffsets().y<=i?this[s[e]](t):n[e].push(t)},this),this.images=n.images,this.areas=n.areas},loadsync:function(t,e){if(t.length){var i=window.getScroll().y,n=this.threshold+i,s="areas"==e;if(t=t.filter(function(t){return s&&(t="none"==t.getStyle("display")?t.parentNode:t),t.getOffsets().y<=n}),t.length){var i=t.shift(),o=this.loadsync.bind(this,[this[e].erase(i),e]);if(s)return this.loadAreaData(i,o);this.loadImgSrc(i,!1,o)}}},getThreshold:function(){if(this.options.threshold)return this.options.threshold;var t=this.options.config.diff,e=window.getSize().y;return"default"===t?1*e:e+t},getItemsLength:function(){return this.images.length+this.areas.length}}),Tabs=new Class({Implements:[AutoPlay,LazyLoad],options:{eventType:"mouse",hasTriggers:!0,triggersBox:".switchable-triggerBox",triggers:".switchable-trigger",content:".switchable-content",panels:".switchable-panel",activeIndex:0,activeClass:"active",steps:1,delay:100,haslrbtn:!1,prev:".prev",next:".next",autoplay:!1,disableCls:null},initialize:function(t,e){(this.container=$(t))&&(this.setOptions(e),this.activeIndex=this.options.activeIndex,this.init())},init:function(){this.fireEvent("load"),this.getMarkup(),this.triggersEvent().extendPlugins(),this.options.hasTriggers&&this.triggers[this.activeIndex]&&this.triggers[this.activeIndex].addClass(this.options.activeClass),this.options.showClass&&this.panels[this.activeIndex]&&this.panels[this.activeIndex].addClass(this.options.showClass),this.options.islazyload&&this.fireEvent("beforeSwitch",{toIndex:this.activeIndex}),this.fireEvent("init")},extendPlugins:function(){var t=this.options;t.autoplay&&this._autoInit(this.autofn.bind(this)),t.islazyload&&this._lazyloadInit(this.getLazyPanel.bind(this)),Tabs.plugins.each(function(t){t.init&&t.init.call(this)},this)},autofn:function(){this.switchTo(this.activeIndex<this.length-1?this.activeIndex+1:0,"FORWARD")},getMarkup:function(){var t,e=this.container,i=this.options;return i.hasTriggers&&(t=$(i.triggersBox)||e.getElement(i.triggersBox)),this.triggers=t?t.getChildren():e.getElements(i.triggers),panels=this.panels=e.getElements(i.panels),this.content=$(i.content)||e.getElement(i.content)?e.getElement(i.content):panels[0]?panels[0].getParent():[],this.content=Array.from(this.content),!panels.length&&this.content.length&&(this.panels=this.content[0].getChildren()),this.panels.length?(this.activeIndex=this.activeIndex.limit(0,this.panels.length-1),void(this.length=this.panels.length/i.steps)):this},triggersEvent:function(){var t=this.options,e=this.triggers;return t.hasTriggers&&e.each(function(e,i){e.addEvent("click",function(t){this.options.stopEvent&&t.stop(),this.triggerIsValid(i)&&this.cancelTimer().switchTo(i)}.bind(this)),"mouse"===t.eventType&&e.addEvents({mouseenter:function(e){this.triggerIsValid(i)&&(this.switchTimer=this.switchTo.delay(t.delay,this,i))}.bind(this),mouseleave:this.cancelTimer.bind(this)})},this),t.haslrbtn&&this.lrbtn(),this},lrbtn:function(){var t=this;["prev","next"].each(function(e){this[e+"btn"]=this.container.getElements(this.options[e]).addEvent("click",function(i){this.hasClass(t.options.disableCls)||t[e]()})},this),this.disabledBtn()},disabledBtn:function(){var t=this.options.disableCls;t&&this.addEvent("switch",function(e){e=e.currentIndex,e=0===e?this.prevbtn:e===Math.ceil(this.length)-1?this.nextbtn:void 0,this.nextbtn.removeClass(t),this.prevbtn.removeClass(t),e&&e.addClass(t)}.bind(this))},triggerIsValid:function(t){return this.activeIndex!==t},cancelTimer:function(){return this.switchTimer&&(clearTimeout(this.switchTimer),this.switchTimer=void 0),this},switchTo:function(t,e){var i=this.options,n=this.triggers,s=this.panels,o=this.activeIndex,a=i.steps,r=o*a,h=t*a;return this.triggerIsValid(t)?(this.fireEvent("beforeSwitch",{toIndex:t}),i.hasTriggers&&this.switchTrigger(o>-1?n[o]:null,n[t]),void 0===e&&(e=t>o?"FORWARD":"BACKWARD"),this.switchView(s.slice(r,r+a),s.slice(h,h+a),t,e),this.activeIndex=t,this.fireEvent("switch",{currentIndex:t})):this},switchTrigger:function(t,e,i){i=this.options.activeClass,t&&t.removeClass(i),e&&e.addClass(i)},switchView:function(t,e,i,n){(i=this.options.showClass)&&(t[0].removeClass(i),e[0].addClass(i)),t[0].setStyle("display","none"),e[0].setStyle("display","")},prev:function(){var t=this.activeIndex;this.switchTo(t>0?t-1:this.length-1,"BACKWARD")},next:function(){var t=this.activeIndex;this.switchTo(t<this.length-1?t+1:0,"FORWARD")},getLazyPanel:function(t){var e=this.options.steps;return t=t[0].toIndex*e,this.panels.slice(t,t+e)}});Tabs.plugins=[],Tabs.Effects={none:function(t,e){t[0].setStyle("display","none"),e[0].setStyle("display","block")},fade:function(t,e){if(1!==t.length)throw Error("fade effect only supports steps == 1.");var i=t[0],n=e[0];this.anim&&this.anim.cancel(),this.anim=new Fx.Tween(i,{duration:this.options.duration,onStart:function(){n.setStyle("opacity",1)},onCancel:function(){this.element.setOpacity(0),this.fireEvent("complete")},onComplete:function(){n.setStyle("zIndex",2),i.setStyle("zIndex",1),this.anim=void 0}.bind(this)}).start("opacity",1,0)},scroll:function(t,e,i,n){function s(t){for(var e=m?r-1:0,i=(e+1)*c,e=e*c;i>e;e++){var n=(m?-1:1)*l*r;d[e].setStyle("position",t?"relative":"").setStyle(p,t?n:"")}return t?m?l:-l*r:h.setStyle(p,m?-l*(r-1):"")}var o=this;e=this.options,t=this.activeIndex;var a="scrollx"===e.effect,r=this.length,h=this.content[0],l=this.viewSize[a?0:1],c=e.steps,d=this.panels,p=a?"left":"top";e=-l*i;var u,m="FORWARD"!==n,p="absolute"==h.getStyle("position")?p:"margin-"+p;(u=m&&0===t&&i===r-1||!m&&t===r-1&&0===i)&&(e=s.call(this,!0)),fromp=h.getStyle(p).toInt(),fromp=isNaN(fromp)?0:fromp,this.anim&&this.anim.cancel(),this.anim=new Fx.Tween(h,{duration:this.options.duration,transition:this.options.transition,onComplete:function(){u&&s.call(o),this.anim=void 0}.bind(this)}).start(p,fromp,e)}},Effects=Tabs.Effects,Effects.scrollx=Effects.scrolly=Effects.scroll;var Switchable=new Class({Extends:Tabs,options:{autoplay:!0,position:"absolute",isFloat:!0,effect:"none",circular:!1,duration:500,transition:Fx.Transitions.linear,direction:"FORWARD",viewSize:[]},extendPlugins:function(){this.parent(),this.effInit()},effInit:function(){var t=this.options,e=t.effect,i=this.panels,n=this.content[0],s=t.steps,o=this.activeIndex,a=i.length,r=i[0].measure(function(){return{x:this.getSize().x?this.getSize().x+this.getPatch("margin").x:this.getStyle("width").toInt()+this.getPatch().x,y:this.getSize().y?this.getSize().y+this.getPatch("margin").y:this.getStyle("height").toInt()+this.getPatch().y}});if(this.viewSize=[t.viewSize[0]||r.x*s,t.viewSize[1]||r.y*s],"none"!==e)switch(e){case"scrollx":case"scrolly":"absolute"==t.position?(n.setStyle("position","absolute"),n.getParent().setStyles({position:"relative"})):"relative"==t.position&&n.setStyle("position","relative"),"scrollx"===e&&(t.isFloat&&i.setStyle("float","left"),n.setStyle("width",a/s*this.viewSize[0]));break;case"fade":var h,l=o*s,c=l+s-1;i.each(function(e,i){h=i>=l&&c>=i,e.setStyles({opacity:h?1:0,position:t.position||"",zIndex:h?2:1})})}},switchView:function(t,e,i,n){var s=this.options,o=s.effect,a=s.circular,o="function"==typeOf(o)?o:Effects[o];a&&(n=s.direction),o&&o.call(this,t,e,i,n)}}),Accordion=new Class({Extends:Tabs,options:{eventType:"click",multiple:!1},triggerIsValid:function(t){return this.activeIndex!==t||this.options.multiple},switchView:function(t,e,i){var n=this.options;e=e[0],n.multiple?(this.triggers[i].toggleClass(n.activeClass),e.setStyle("display","none"==e.getStyle("display")?"block":"none")):(t[0].setStyle("display","none"),e.setStyle("display","block"))}}),Slide=new Class({Extends:Switchable,options:{viewStep:4},effect:function(t,e,i,n){function s(t){for(var e=p?a-1:0,i=(e+1)*l,e=e*l;i>e;e++){var n=(p?-1:1)*h*a;c[e].setStyle("position",t?"relative":"").setStyle(d,t?n:"")}return t?p?h:-h*a:r.setStyle(d,p?-h*(a-1):"")}t=this.options,e=this.activeIndex;var o="scrollx"===t.effect,a=this.length,r=this.content[0],h=this.viewSize[o?0:1],l=t.steps,c=this.panels,d=o?"left":"top",o=-h*i,p="FORWARD"!==n;if((p&&0===e&&i===a-1||!p&&e===a-1&&0===i)&&(o=s.call(this,!0)),fromp=r.getStyle(d).toInt(),fromp=isNaN(fromp)?0:fromp,this.anim)return this;var u=[],m=t.viewStep,f=m-l;this.anim=new Fx.Tween(r,{duration:this.options.duration,transition:this.options.transition,onStart:function(){if(this.to[0].value=p?h:-h,!p){for(var t,e=i,n=m-1;n>=0;n--)e++,e>a&&(t||(t=m-n),u.push(n),c[n].setStyle(d,t*h));i||(c[f].setStyle(d,h),c[0].setStyle(d,h))}},onComplete:function(){r.setStyle(d,0),c.each(function(t,e){var n=i?-h*i:0,s=i+m-a;p&&s>e&&(n=-h*(i-a)),!p&&u.contains(e)&&(n=h*(f-u[0])),t.setStyle("position","relative").setStyle(d,n)}),this.anim=void 0}.bind(this)}).start(d,fromp,o)},switchView:function(t,e,i,n){var s=this.options;s.circular&&(n=s.direction),this.effect(t,e,i,n)}});Switchable.autoRender=function(t,e){var i,n=t||".auto-bind-widget",n=$(e||document.body).getElements(n);Array.from($$("img[data-src]"),$$("textarea.action-lazyload")).length&&(i=$(document.body).get("data-lazyload-config")||"",new DataLazyLoad(JSON.decode(i))),n.length&&n.each(function(t){var e=t.get("data-widget-type");if(e&&-1<"Tabs Switchable Slide DropMenu Accordion DataLazyLoad".indexOf(e))try{if(i=t.get("data-widget-config")||"","DataLazyLoad"===e)return new window[e](JSON.decode(i),t);new window[e](t,JSON.decode(i))}catch(n){}})},window.addEvent("domready",Switchable.autoRender.bind(Switchable));